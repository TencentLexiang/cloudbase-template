{
  "version": "2.0",
  "envId": "{{env.ENV_ID}}",
  "framework": {
    "name": "lxservice",
    "requirement": {
      "environment": {
        "LX_SUITE_ID": {
          "description": "腾讯乐享的suite_id",
          "required": true,
          "default": "",
          "validation": {
            "rule": {
              "type": "RegExp",
              "pattern": "{32}",
              "flag": "g"
            },
            "errorMessage": "必须是32位长度的字符串"
          }
        },
        "LX_SUITE_SECRET": {
          "description": "腾讯乐享的suite_secret",
          "required": true,
          "default": "",
          "validation": {
            "rule": {
              "type": "RegExp",
              "pattern": "{40}",
              "flag": "g"
            },
            "errorMessage": "必须是40位长度的字符串"
          }
        },
        "LX_CALLBACK_SECRET": {
          "description": "腾讯乐享的callback_secret",
          "required": true,
          "default": "",
          "validation": {
            "rule": {
              "type": "RegExp",
              "pattern": "{40}",
              "flag": "g"
            },
            "errorMessage": "必须是40位长度的字符串"
          }
        },
        "LX_API_URL": {
          "description": "腾讯乐享的API基础路径（使用默认值即可）",
          "required": false,
          "default": "https://lxapi.lexiangla.com/cgi-bin/"
        },
        "LX_AUTH_URL": {
          "description": "腾讯乐享的登录授权地址（使用默认值即可）",
          "required": false,
          "default": "https://lexiangla.com/connect/oauth2/authorize"
        },
        "PERSISTENCE": {
          "description": "客户端存储引擎（可选：local，session）",
          "required": false,
          "default": "local"
        }
      }
    },
    "plugins": {
      "function": {
        "use": "@cloudbase/framework-plugin-function",
        "inputs": {
          "functionRootPath": "./functions",
          "functionDefaultConfig": {
            "runtime": "Nodejs10.15",
            "handler": "index.main",
            "timeout": 60,
            "memorySize": 128,
            "envVariables": {
              "ENV_ID": "{{env.ENV_ID}}"
            }
          },
          "servicePaths": {
            "base_suite_callback": "/suite_callback"
          }
        }
      },
      "database": {
        "use": "@cloudbase/framework-plugin-database",
        "inputs": {
          "collections": [
            {
              "collectionName": "lx_suite_callback_logs",
              "createIndexes": [
                {
                  "name": "lx_suite_callback_logs_action_index",
                  "unique": false,
                  "keys": [
                    {
                      "name": "action",
                      "direction": "1"
                    }
                  ]
                }
              ]
            },
            {
              "collectionName": "lx_suites"
            },
            {
              "collectionName": "companies"
            },
            {
              "collectionName": "users"
            },
            {
              "collectionName": "departments",
              "createIndexes": [
                {
                  "name": "departments_company_id_version_index",
                  "unique": false,
                  "keys": [
                    {
                      "name": "company_id",
                      "direction": "1"
                    },
                    {
                      "name": "version",
                      "direction": "1"
                    }
                  ]
                }
              ]
            },
            {
              "collectionName": "department_user",
              "createIndexes": [
                {
                  "name": "department_user_company_id_version_index",
                  "unique": false,
                  "keys": [
                    {
                      "name": "company_id",
                      "direction": "1"
                    },
                    {
                      "name": "version",
                      "direction": "1"
                    }
                  ]
                }
              ]
            },
            {
              "collectionName": "courses",
              "createIndexes": [
                {
                  "name": "courses_lx_id_index",
                  "unique": false,
                  "keys": [
                    {
                      "name": "lx_id",
                      "direction": "1"
                    }
                  ]
                }
              ]
            },
            {
              "collectionName": "course_categories"
            }
          ]
        }
      },
      "client": {
        "use": "@cloudbase/framework-plugin-website",
        "inputs": {
          "installCommand": "cd vue && yarn install",
          "buildCommand": "cd vue && yarn build",
          "outputPath": "vue/dist",
          "cloudPath": "/",
          "ignore": [],
          "envVariables": {
            "REGION": "{{env.REGION}}",
            "LX_SUITE_ID": "{{env.LX_SUITE_ID}}",
            "LX_AUTH_URL": "{{env.LX_AUTH_URL}}",
            "PERSISTENCE": "{{env.PERSISTENCE}}"
          }
        }
      }
    },
    "hooks": {
      "preDeploy": {
        "type": "execCommand",
        "commands": []
      },
      "postDeploy": {
        "type": "callFunction",
        "functions": []
      }
    }
  },
  "functions": [
    {
      "name": "base_suite_callback",
      "envVariables": {
        "LX_SUITE_ID": "{{env.LX_SUITE_ID}}",
        "LX_CALLBACK_SECRET": "{{env.LX_CALLBACK_SECRET}}"
      }
    },
    {
      "name": "base_login_user",
      "aclRule": {
        "invoke": true
      }
    },
    {
      "name": "lx_get_suite_access_token",
      "envVariables": {
        "LX_SUITE_ID": "{{env.LX_SUITE_ID}}",
        "LX_SUITE_SECRET": "{{env.LX_SUITE_SECRET}}",
        "LX_API_URL": "{{env.LX_API_URL}}"
      },
      "triggers": [
        {
          "name": "lx_get_suite_access_token",
          "type": "timer",
          "config": "0 */30 * * * * *"
        }
      ],
      "publicNet": "ENABLE",
      "eip": "ENABLE"
    },
    {
      "name": "lx_get_corp_info",
      "envVariables": {
        "LX_API_URL": "{{env.LX_API_URL}}"
      },
      "publicNet": "ENABLE",
      "eip": "ENABLE"
    },
    {
      "name": "lx_get_user_info",
      "envVariables": {
        "LX_API_URL": "{{env.LX_API_URL}}"
      },
      "publicNet": "ENABLE",
      "eip": "ENABLE"
    },
    {
      "name": "lx_get_corp_token",
      "envVariables": {
        "LX_API_URL": "{{env.LX_API_URL}}"
      },
      "triggers": [
        {
          "name": "lx_get_corp_token",
          "type": "timer",
          "config": "0 */30 * * * * *"
        }
      ],
      "publicNet": "ENABLE",
      "eip": "ENABLE"
    },
    {
      "name": "lx_course",
      "envVariables": {
        "LX_API_URL": "{{env.LX_API_URL}}"
      },
      "publicNet": "ENABLE",
      "eip": "ENABLE"
    },
    {
      "name": "lx_category",
      "envVariables": {
        "LX_API_URL": "{{env.LX_API_URL}}"
      },
      "publicNet": "ENABLE",
      "eip": "ENABLE"
    },
    {
      "name": "third_course"
    }
  ],
  "region": "ap-shanghai",
  "functionRoot": "./functions"
}
